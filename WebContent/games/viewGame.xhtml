<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h ="http://java.sun.com/jsf/html"
	  xmlns:f ="http://xmlns.jcp.org/jsf/core"
	  xmlns:p="http://primefaces.org/ui">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />

<title>#{gameMB.game.nmGame} - GameSystem</title>
</h:head>

<f:metadata>
	<f:viewParam name="g" value="#{gameMB.game.nmGame}"></f:viewParam>
	<f:viewParam name="p" value="#{gameMB.game.idPlataform}"></f:viewParam>
	<f:viewAction action="#{gameMB.startGamePage()}"></f:viewAction>
</f:metadata>

<h:body>
	
	<p:growl id="grGlobal" autoUpdate="true"></p:growl>
	
	<p:panelGrid columns="2">
		<p:outputLabel value="Game:"></p:outputLabel>
		<h:outputText value="#{gameMB.game.nmGame}"></h:outputText>
		
		<p:outputLabel value="id:"></p:outputLabel>
		<h:outputText value="#{gameMB.game.idGame}"></h:outputText>
		
		<p:outputLabel value="Plataforma:"></p:outputLabel>
		<h:outputText value="#{gameMB.game.nmPlataform}"></h:outputText>
		
		<p:outputLabel value="Desenvolvedor"></p:outputLabel>
		<h:outputText value="#{gameMB.game.nmDeveloper}"></h:outputText>
		
		<p:outputLabel value="Nota Média:"></p:outputLabel>
		<h:outputText value="#{gameMB.gameAvgGrade}"></h:outputText>
	</p:panelGrid>
	<br/>
	
	<h:form id="frmGrade">
		<p:fieldset legend="Avaliar Game" toggleable="true" toggleSpeed="500" collapsed="true">
			<p:panelGrid rendered="#{!gameMB.alreadyGradedbyUser}">
				<h2><h:outputLabel value="Dê sua Nota para #{gameMB.game.nmGame}" ></h:outputLabel></h2>
				<p:inputNumber decimalPlaces="1" maxValue="10" minValue="0" value="#{gameMB.txtGrade}"></p:inputNumber>
				<p:commandButton value="Avaliar" action="#{gameMB.gradeGame}"></p:commandButton>
			</p:panelGrid>
			
			<p:panelGrid rendered="#{gameMB.alreadyGradedbyUser}">
				<h2><h:outputLabel value="Edite sua Nota para #{gameMB.game.nmGame}" ></h:outputLabel></h2>
				<p:inputNumber decimalPlaces="1" maxValue="10" minValue="0" value="#{gameMB.txtGrade}"></p:inputNumber>
				<p:commandButton value="Editar" action="#{gameMB.editGrade}"></p:commandButton>
			</p:panelGrid>
		</p:fieldset>
	</h:form>
	<br/>
	
	<h:form id="frmCompleted">
		<p:fieldset legend="Marcar como Completado" toggleable="true" toggleSpeed="500" collapsed="true">
			<p:panelGrid>
				<p><p:outputLabel value="Você já marcou esse game como completado" rendered="#{gameMB.alreadyCompletedbyUser}"></p:outputLabel></p>
				<p:commandButton rendered="#{!gameMB.alreadyCompletedbyUser}" value="Game Completado" action="#{gameMB.markAsCompleted}"></p:commandButton>
				<p:commandButton rendered="#{gameMB.alreadyCompletedbyUser}" value="Remover da Lista de Completados" action="#{gameMB.removeCompleted}"></p:commandButton>
			</p:panelGrid>
		</p:fieldset>
	</h:form>
	<br/>
	
	<h:form id="frmComments">
		<p:panel header="Comentários">
			<p:dataList id="grdComments"
			value="#{gameMB.comments}" var="comment" 
			emptyMessage="Nenhum Comentário foi escrito para este jogo. Contribua com o seu!" 
			type="none" rows="20" 
			paginator="true" paginatorAlwaysVisible="false">
				
				<p:panelGrid style="width:100%">
					<p:row >
						<p:column>							
							Por <h:link value="#{comment.nmUser}" outcome="/user/viewUser">
								<f:param name="user" value="#{comment.nmUser}"></f:param>
							</h:link> em #{comment.dtComment}
						</p:column>						
					</p:row>
					<p:row>					
						<p:column colspan="2">
							<h:outputText id="txtRowComment" value="#{comment.deComment}" escape="false" ></h:outputText>													
						</p:column>
					</p:row>	
				</p:panelGrid>
				<br/>												
			</p:dataList>			
		</p:panel>
		<br/>
		
		<p:fieldset legend="Fazer Comentário" toggleable="true" toggleSpeed="500" collapsed="true">
				 <p:outputLabel rendered="#{gameMB.alreadyCommentedbyUser}" value="Você já fez um comentário neste game, se quiser pode editá-lo abaixo:"></p:outputLabel>       
        		 <p:textEditor id="txtComment" value="#{gameMB.comment.deComment}" 
        		 				validatorMessage="Tamanho máximo 250 caracteres" 
        		 				required="true" 
        		 				requiredMessage="Preencha o comentário para continuar">
        		 	<f:validateLength maximum="250"></f:validateLength>
        		 </p:textEditor>
        		 <!-- Quando usuário ainda não comentou -->
        		 <p:commandButton rendered="#{!gameMB.alreadyCommentedbyUser}" action="#{gameMB.createNewComment}" value="Enviar Comentário">
        		 </p:commandButton>
        		 
        		 <!-- Quando Usuário já comentou -->
        		 <p:commandButton rendered="#{gameMB.alreadyCommentedbyUser}" action="#{gameMB.editComment}" value="Editar Comentário">
        		 </p:commandButton>
        		 <p:commandButton rendered="#{gameMB.alreadyCommentedbyUser}" action="#{gameMB.deleteComment}" value="Remover Comentário">
        		 </p:commandButton>
    	</p:fieldset>
	</h:form>
		
</h:body>
</html>